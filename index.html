<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Image Search</title>
  <link rel="stylesheet" href="style.css">
  <script
  src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.21.0/axios.min.js"></script>
</head>
<body>
  <h1>Unsplash API photos search</h1>
  <div class="boxContainer">
    <table class="elementsContainer">
      <tr>
        <td>
          <input id="mySearch" type="text" placeholder="Search" class="search">
        </td>
        <td>
          <a id="mySubmit" href="javascript:void(0);">
            <img class="search_icon" src="img/baseline_search.png" alt="">
          </a>
        </td>
      </tr>
    </table>
  </div>
  <div id="myCpntainer" class="main_container">
    <div class="card">
      <div class="card_img">
        <img src="https://images.unsplash.com/photo-1532906619279-a4b7267faa66?crop=entropy&cs=srgb&fm=jpg&ixid=MXwxODkyMDF8MHwxfHNlYXJjaHwxfHxmMXxlbnwwfDB8fA&ixlib=rb-1.2.1&q=85" alt="">
      </div>
      <div class="card_content">
        <div class="card_name">
          <img class="head_img" src="https://images.unsplash.com/profile-fb-1484539966-12de6566b969.jpg?ixlib=rb-1.2.1&q=80&fm=jpg&crop=faces&cs=tinysrgb&fit=crop&h=32&w=32" alt="">
          <div>Carl Jorgensen</div>
        </div>
        <div class="card_des">
          Taken at the British Grand Prix at Silverstone in the UK. Never realised how fast these cars until now. The television does not do it justice.
        </div>
      </div>
    </div>
  </div>
  <div class="mypage_content" style="display: none;">
    <ul class="pagination">
      <li>
        <a href="javascript:void(0);" class="prev"> < </a>
      </li>
      <li class="pageNumber active">
        <a href="javascript:void(0);">1</a>
      </li>
      <li class="pageNumber">
        <a href="javascript:void(0);">2</a>
      </li>
      <li class="pageNumber">
        <a href="javascript:void(0);">3</a>
      </li>
      <li class="pageNumber">
        <a href="javascript:void(0);">4</a>
      </li>
      <li class="pageNumber">
        <a href="javascript:void(0);">5</a>
      </li>
      <li class="pageNumber">
        <a href="javascript:void(0);">6</a>
      </li>
      <li class="pageNumber">
        <a href="javascript:void(0);">7</a>
      </li>
      <li class="pageNumber">
        <a href="javascript:void(0);">8</a>
      </li>
      <li class="pageNumber">
        <a href="javascript:void(0);">9</a>
      </li>
      <li class="pageNumber">
        <a href="javascript:void(0);">10</a>
      </li>
      <li>
        <a href="javascript:void(0);" class="next"> > </a>
      </li>
    </ul>
    <div class="nextBig" onclick="nextBigPage()">+10</div>
    <div class="prevBig" onclick="prevBigPage()">-10</div>
  </div>
  <script>
    // 當前頁碼
    var page_num = 1;
    // 大頁碼
    var big_page = 1;
    // 現在搜尋的資料
    var now_search = '';
    // 總頁數
    var total_page = 0;

    // 獲取資料

    $('#mySubmit').on('click', function(){
      var search = $('#mySearch').val();
      now_search = search;
      let search_resilt = '';
      let page_list = '';
      console.log(search);
      axios.get(
        `https://api.unsplash.com/search/photos/?query=${search}&client_id=z2lKI1fv5HipWjpXTi6YFxymvT6Fg1z5mIDBIYK3RqA&page=1&orientation=landscape&per_page=12`
      ).then(function(response){
        let result_data = response.data.results;
        var total = response.data.total;
        total_page = response.data.total_pages;
        console.log(result_data);
        console.log(total);
        console.log(total_page);
        // 繪製畫面
        result_data.map(data => {
          search_resilt += `
            <div class="card">
              <div class="card_img">
                <img src="${data.urls.small}" alt="">
              </div>
              <div class="card_content">
                <div class="card_name">
                  <img class="head_img" src="${data.user.profile_image.small}" alt="">
                  <div>${data.user.name}</div>
                </div>
                <div class="card_des">
                  ${data.description}
                </div>
              </div>
            </div>
          `
        });

        page_list += `
          <li onclick="prev_page()">
            <a href="javascript:void(0);" class="prev"> < </a>
          </li>
        `
        for(let x = 1; x<= 10; x++){
          if(x == 1){
            page_list += `
              <li class="pageNumber active" onclick="page_click(${x})">
                <a>${x}</a>
              </li>
            `
          } else {
            page_list += `
              <li class="pageNumber" onclick="page_click(${x})">
                <a href="javascript:void(0);">${x}</a>
              </li>
            `
          }
        }
        page_list += `
          <li onclick="next_page()">
            <a href="javascript:void(0);" class="next"> > </a>
          </li>
        `
        $('.pagination').html(page_list);

        $('#myCpntainer').html(search_resilt);
        $('.mypage_content').show();
      }).catch(function(error){
        console.log(error)
      })
    })

    // $('.next').on('click', function(){
    //   page_num++;
    //   $('.pagination').find('.pageNumber.active').next().addClass('active');
    //   $('.pagination').find('.pageNumber.active').prev().removeClass('active');
    //   console.log('next_num', page_num);
    // })
    // $('.prev').on('click', function(){
    //   page_num--;
    //   if(page_num > 0){
    //     $('.pagination').find('.pageNumber.active').prev().addClass('active');
    //     $('.pagination').find('.pageNumber.active').next().removeClass('active');
    //   } else {
    //     alert('已是最前頁');
    //     page_num = 1;
    //   }
    //   console.log('prev_num', page_num);
    // })

    function page_click(num){
      console.log(num);
      page_num = num;
      // 頁籤重繪
      pageList_change();

      // 重新抓取資料
      axios.get(
        `https://api.unsplash.com/search/photos/?query=${now_search}&client_id=z2lKI1fv5HipWjpXTi6YFxymvT6Fg1z5mIDBIYK3RqA&page=1&orientation=landscape&per_page=12&page=${page_num}`
      ).then(function(response){
        let result_data = response.data.results;
        let search_resilt = '';
        // 繪製畫面
        result_data.map(data => {
          search_resilt += `
            <div class="card">
              <div class="card_img">
                <img src="${data.urls.small}" alt="">
              </div>
              <div class="card_content">
                <div class="card_name">
                  <img class="head_img" src="${data.user.profile_image.small}" alt="">
                  <div>${data.user.name}</div>
                </div>
                <div class="card_des">
                  ${data.description}
                </div>
              </div>
            </div>
          `
        });
        $('#myCpntainer').html(search_resilt);

        // 滑到最上面
        scrollTop();
      }).catch(function(error){
        console.log(error)
      })
    }

    function next_page(){
      page_num++;
      if(page_num > total_page){
        alert('已到最底頁了');
        page_num = total_page
      } else {
        // $('.pagination').find('.pageNumber.active').next().addClass('active');
        // $('.pagination').find('.pageNumber.active').prev().removeClass('active');
        console.log('next_num', page_num);
        axios.get(
          `https://api.unsplash.com/search/photos/?query=${now_search}&client_id=z2lKI1fv5HipWjpXTi6YFxymvT6Fg1z5mIDBIYK3RqA&page=1&orientation=landscape&per_page=12&page=${page_num}`
        ).then(function(response){
          let result_data = response.data.results;
          let search_resilt = '';
          // 繪製畫面
          result_data.map(data => {
            search_resilt += `
              <div class="card">
                <div class="card_img">
                  <img src="${data.urls.small}" alt="">
                </div>
                <div class="card_content">
                  <div class="card_name">
                    <img class="head_img" src="${data.user.profile_image.small}" alt="">
                    <div>${data.user.name}</div>
                  </div>
                  <div class="card_des">
                    ${data.description}
                  </div>
                </div>
              </div>
            `
          });
          $('#myCpntainer').html(search_resilt);
          // 頁籤重繪
          pageList_change();

          // 滑到最上面
          scrollTop();
        }).catch(function(error){
          console.log(error)
        })
      }
    }

    function prev_page(){
      page_num--;
      if(page_num > 0){
        axios.get(
          `https://api.unsplash.com/search/photos/?query=${now_search}&client_id=z2lKI1fv5HipWjpXTi6YFxymvT6Fg1z5mIDBIYK3RqA&page=1&orientation=landscape&per_page=12&page=${page_num}`
        ).then(function(response){
          let result_data = response.data.results;
          let search_resilt = '';
          // 繪製畫面
          result_data.map(data => {
            search_resilt += `
              <div class="card">
                <div class="card_img">
                  <img src="${data.urls.small}" alt="">
                </div>
                <div class="card_content">
                  <div class="card_name">
                    <img class="head_img" src="${data.user.profile_image.small}" alt="">
                    <div>${data.user.name}</div>
                  </div>
                  <div class="card_des">
                    ${data.description}
                  </div>
                </div>
              </div>
            `
          });
          $('#myCpntainer').html(search_resilt);
        }).catch(function(error){
          console.log(error)
        })
        // $('.pagination').find('.pageNumber.active').prev().addClass('active');
        // $('.pagination').find('.pageNumber.active').next().removeClass('active');

        // 頁籤重繪
        pageList_change();

        // 滑到最上面
        scrollTop();
      } else {
        alert('已是最前頁');
        page_num = 1;
      }
      // console.log('prev_num', page_num);
    }

    function pageList_change(){
      let page_list = '';

      // 頁籤重繪
      page_list += `
        <li onclick="prev_page()">
          <a href="javascript:void(0);" class="prev"> < </a>
        </li>
      `
      // 需修改
      for(let x = (big_page*10)-9; x<= big_page*10; x++){
        if(x == page_num){
          page_list += `
            <li class="pageNumber active" onclick="page_click(${x})">
              <a>${x}</a>
            </li>
          `
        } else {
          page_list += `
            <li class="pageNumber" onclick="page_click(${x})">
              <a href="javascript:void(0);">${x}</a>
            </li>
          `
        }
      }
      page_list += `
        <li onclick="next_page()">
          <a href="javascript:void(0);" class="next"> > </a>
        </li>
      `
      $('.pagination').html(page_list);
    }

    function nextBigPage(){
      big_page++;
      if(big_page*10-10 > total_page){
        alert('已到最底頁了');
        big_page = big_page - 1
      } else {

        page_num = big_page*10-9

        pageList_change();

        // 重新抓取資料
        axios.get(
          `https://api.unsplash.com/search/photos/?query=${now_search}&client_id=z2lKI1fv5HipWjpXTi6YFxymvT6Fg1z5mIDBIYK3RqA&page=1&orientation=landscape&per_page=12&page=${page_num}`
        ).then(function(response){
          let result_data = response.data.results;
          let search_resilt = '';
          // 繪製畫面
          result_data.map(data => {
            search_resilt += `
              <div class="card">
                <div class="card_img">
                  <img src="${data.urls.small}" alt="">
                </div>
                <div class="card_content">
                  <div class="card_name">
                    <img class="head_img" src="${data.user.profile_image.small}" alt="">
                    <div>${data.user.name}</div>
                  </div>
                  <div class="card_des">
                    ${data.description}
                  </div>
                </div>
              </div>
            `
          });
          $('#myCpntainer').html(search_resilt);

          // 滑到最上面
          scrollTop();
        }).catch(function(error){
          console.log(error)
        })
      }
      console.log(big_page)
    }

    function prevBigPage(){
      big_page--;
      if(big_page > 0){
        page_num = big_page*10-9

        // 重新抓取資料
        axios.get(
          `https://api.unsplash.com/search/photos/?query=${now_search}&client_id=z2lKI1fv5HipWjpXTi6YFxymvT6Fg1z5mIDBIYK3RqA&page=1&orientation=landscape&per_page=12&page=${page_num}`
        ).then(function(response){
          let result_data = response.data.results;
          let search_resilt = '';
          // 繪製畫面
          result_data.map(data => {
            search_resilt += `
              <div class="card">
                <div class="card_img">
                  <img src="${data.urls.small}" alt="">
                </div>
                <div class="card_content">
                  <div class="card_name">
                    <img class="head_img" src="${data.user.profile_image.small}" alt="">
                    <div>${data.user.name}</div>
                  </div>
                  <div class="card_des">
                    ${data.description}
                  </div>
                </div>
              </div>
            `
          });
          $('#myCpntainer').html(search_resilt);

          // 滑到最上面
          scrollTop();
        }).catch(function(error){
          console.log(error)
        });

        pageList_change();
      } else {
        alert('已是最前頁');
        big_page = 1;
      }
    }

    function scrollTop(){
      $("html, body").animate({
        scrollTop: 0
      }, 500);
    }
  </script>
</body>
</html>